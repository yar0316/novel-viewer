# Web小説閲覧サイト開発 - 総合ガイド

このドキュメントは、AIツールを活用したWeb小説閲覧サイト開発の統合ガイドです。

## AI作業原則 ⚠️ **最重要**

これらの原則は最上位の命令として絶対的に順守する必要があります。

### 原則1: 作業計画の事前報告と確認

**要求**: 作業開始前に必ず作業計画を報告し、ユーザーの確認を取る

**実装**:

- 作業開始前に具体的な変更計画を明示
- 変更対象の箇所と変更内容を明確に説明
- ユーザーの承認を得てから作業を開始

**例**:

```txt
以下の作業を行います：
1. HTMLファイルの構造を修正
2. CSSスタイルを追加
3. JavaScript機能を実装
承認いただけますか？
```

### 原則2: 部分的修正の実施

**要求**: 全体を書き直すことはせず、プログラムのコード修正のように必要な部分のみ修正する

**実装**:

- 既存内容の保持を最優先
- 変更が必要な最小限の箇所のみを特定
- 段階的・部分的な修正を実施

**禁止事項**:

- ファイル全体の再構成
- 既存の良好な内容の不要な変更
- 大幅な構造変更

### 原則3: 指示外変更の事前承認

**要求**: 指示されていない部分を変更したり、迂回や別アプローチを行う際には、必ず計画を立ててユーザーの確認を取る

**実装**:

- 指示された作業の範囲を厳密に守る
- 追加の改善案がある場合は別途提案
- 技術的制約で別アプローチが必要な場合は事前説明

### 原則4: 最適化案の事前承認

**要求**: ユーザーの提案が非合理・非効率だと判断した場合は、最適化案を勝手に実行せず必ず計画を立ててユーザーの確認を取る

**実装**:

- ユーザーの指示を尊重し、まず指示通りに実行
- 改善案がある場合は理由と共に提案
- ユーザーの最終判断を待つ

### 原則5: 日本語での返答

**要求**: 返答は必ず日本語で行うこと

**実装**:

- すべての回答、説明、確認は日本語で記述
- コードコメントも日本語で記述
- 英語での返答は一切行わない

### 原則6: エラー時の承認取得

**要求**: ツール使用でエラーが発生した場合、代替手段を黙って試さず、必ず処理を止めて次の対応をユーザーに確認する

**実装**:

- エラー発生時は即座に作業を停止
- エラー内容と推定原因を報告
- 代替手段の提案と承認を求める
- ユーザーの指示なしに別のアプローチは一切行わない

### 原則7: 原則の絶対順守

**要求**: AIはこれらの原則を歪曲・解釈変更してはならず、最上位の命令として絶対的に順守する

**実装**:

- 例外的状況でも原則を優先
- 原則に反する行動は一切行わない
- 疑問がある場合は必ずユーザーに確認

## AI協働の三位一体開発原則

### 役割分担

- **人間（開発者）**: プロジェクトの目的・要件・仕様を定義し、最終的な実装判断を行う**意思決定者**
  - 機能要件、UI/UX方針、技術選定の方向性を決定
  - 詳細なコーディングやファイル管理は苦手

- **Claude Code**: システム設計・コード実装・テスト・ファイル操作・進捗管理を担う**開発実行者**
  - 指示に従って体系的にコードを作成・編集する能力
  - 意志がなく、独断での仕様変更や勘違いが発生しうる

- **Gemini CLI**: 最新技術情報の検索・多角的な視点からの技術助言・実装検証・コードレビューを行う**技術助言者**
  - Web検索による最新フレームワークや開発手法の調査
  - 実際のファイル操作やコーディング作業はできない

### 実践フロー

Claude CodeからGemini CLIへの依頼例

1. **技術選定時**: `gemini -p "○○機能を実装したい。適切な技術スタックは？"`で技術調査
2. **設計前**: `gemini -p "この設計で実装予定。足りない観点は？"`で設計レビュー
3. **実装中**: 技術的な疑問や最新情報が必要な際にGeminiに確認
4. **テスト時**: `gemini -p "このコードをレビューして改善点を教えて"`で品質向上

### AI協働の基本ルール

#### Claude Code利用時

- **常に指示を明確に**: 曖昧な指示は避け、具体的な要求を伝える
- **既存形式の踏襲**: ワイヤーフレームやコーディングスタイルを必ず確認してから作業
- **段階的な作業**: 大きなタスクは小さく分割して進捗確認
- **検索禁止**: 検索・技術調査は一切行わず、必ずgeminiコマンドを実行する

#### Gemini CLI活用時

- **検索を活用**: 最新情報や技術動向の確認に積極的に活用
- **多角的視点**: 聞き方を変えて複数の観点から意見を収集
- **事実確認**: 技術的な内容の正確性を必ず検証

#### GitHub Copilot連携時

- **コード補完**: HTML/CSS/JavaScriptの効率的な記述
- **自動補完**: 定型的なコードパターンの効率化
- **実装支援**: 実際に動作するコードの作成支援

## TDD開発原則

このプロジェクトでは、**t-wada氏のTDD（テスト駆動開発）**を基本原則とします。
「テスト駆動」ですので、新機能の実装も機能追加も修正も、まずはテストから実装することになります。

### TDDの基本サイクル

1. **Red**: 失敗するテストを書く
2. **Green**: テストを通す最小限のコードを書く
3. **Refactor**: コードを実装する

### TDD適用範囲

- JavaScript機能の実装
- CSS/HTMLの動作確認（可能な範囲で）
- ユーザーインタラクションのテスト

## プロジェクト概要

**プロジェクト名**: Web小説閲覧サイト  
**目的**: 個人利用のシンプルな小説閲覧プラットフォーム  
**技術スタック**: HTML/CSS/JavaScript (フロントエンド重視)  
**デザイン方針**: スマホファースト、カクヨム・小説家になろう風

### 機能要件

#### 基本機能

- ユーザー管理なし
- 投稿・編集機能なし（外部連携で管理）
- 基本的な検索機能のみ
- 3画面構成（一覧、詳細、閲覧）

#### 画面構成

1. **トップページ/小説一覧**
   - 投稿済み小説のリスト表示
   - 各小説のタイトル、概要、更新日、章数を表示
   - シンプルな検索ボックス（タイトル検索）

2. **小説詳細ページ**
   - 小説のタイトル、概要、作者情報
   - 章一覧（章タイトルと投稿日）
   - 各章への読書開始リンク

3. **章閲覧ページ**
   - 章タイトルと本文表示
   - 前の章/次の章へのナビゲーション
   - 小説詳細への戻りリンク

### 技術要件

#### フロントエンド

- **Next.js 15**: React 19完全対応 + App Router + TypeScript
- **shadcn/ui**: LLMフレンドリーなUIコンポーネントシステム
- **Tailwind CSS v4**: 新エンジンによる高速化 + @themeディレクティブ
- **TypeScript**: 型安全な開発環境とSupabase型生成連携

#### バックエンド

- **API**: Supabase Auto-generated RESTful API（カスタム開発不要）
- **データベース**: Supabase PostgreSQL
- **API認証**: Supabase匿名キー（読み取り専用）
- **ユーザー認証**: なし（ログイン機能なし）

#### インフラ構成（Vercel + Supabase）

- **ホスティング**: Vercel（Next.js 15最適化 + Turbopack + Edge Functions）
- **データベース**: Supabase（PostgreSQL + Auto-generated API + TypeScript型生成）
- **API**: Supabase RESTful API（自動生成） + TypeScript SDK連携
- **デプロイ戦略**: 
  - プレビュー環境: ブランチ毎の自動デプロイ
  - 本番環境: mainブランチからの手動デプロイ
  - 開発環境: ローカル + Supabase本番DB接続テスト
- **環境変数管理**: 
  - ローカル: `.env.local`
  - Vercel: プロジェクト設定での環境変数管理
- **型安全性**: 手動定義型 + 将来的にSupabase CLI自動生成への移行
- **監視**: Vercel Analytics + Supabase Dashboard

#### デザイン要件

- **スマホファースト**: 基本的にスマホからの閲覧
- **シンプルデザイン**: カクヨム・小説家になろう風
- **読みやすさ**: フォント設定、行間調整
- **タッチ操作**: しやすいボタンサイズ

## プロジェクト構成

### ディレクトリ構造

```
novel-viewer/
├── docs/                    # 開発ドキュメント
│   ├── general.md                 # このファイル（総合ガイド）
│   ├── overview.md                # プロジェクト概要
│   └── prompts/                   # プロンプト集
├── wireframe/              # ワイヤーフレーム（参考用）
│   ├── index.html         # 一覧画面ワイヤーフレーム
│   ├── novel-detail.html  # 詳細画面ワイヤーフレーム
│   └── chapter.html       # 閲覧画面ワイヤーフレーム
├── frontend/               # Next.js 15アプリケーション
│   ├── app/                # App Router
│   │   ├── layout.tsx      # ルートレイアウト
│   │   ├── page.tsx        # トップページ/小説一覧
│   │   ├── novel/[id]/     # 動的ルーティング
│   │   └── chapter/[id]/   # 章閲覧ページ
│   ├── components/         # コンポーネント
│   │   ├── ui/            # shadcn/ui基本コンポーネント
│   │   └── custom/        # カスタムコンポーネント
│   ├── lib/               # ユーティリティ
│   │   ├── supabase.ts    # Supabase設定・型定義
│   │   └── utils.ts       # 共通関数
│   └── middleware.ts      # Basic認証ミドルウェア
├── tests/                  # テストファイル（TDD用）
└── CLAUDE.md              # AI協働のエントリーポイント
```

### ファイル命名規則

#### Reactコンポーネント

- PascalCase使用: `NovelCard.tsx`
- 機能を表す明確な名前
- TypeScript必須

#### Next.jsページ

- ケバブケース使用: `page.tsx`, `layout.tsx`
- App Router規則に従う

#### ユーティリティファイル

- camelCase使用: `supabase.ts`, `utils.ts`
- 機能単位でファイル分割

#### 型定義ファイル

- camelCase使用: `types.ts`
- Supabase自動生成型との連携

## 開発ワークフロー

### 作業開始時の確認手順

1. 作業内容にキーワード「テスト」「検証」「チェック」が含まれる場合 → テスト・検証プロセスを確認
2. すべての作業で必須 → AI作業原則（上記）とAI協働原則を確認 ⚠️ **最重要**
3. 実装・コーディングの場合 → TDD原則に従った開発
4. ファイル作成・構成の場合 → プロジェクト構成と命名規則を確認

### Supabase接続・デプロイワークフロー

#### ローカル環境でのSupabase接続テスト

```bash
# 1. 環境変数設定
# .env.local ファイルを作成
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# 2. ローカル開発サーバー起動
npm run dev

# 3. 動作確認
# - ブラウザでアクセスし、実際のSupabaseからデータが取得できることを確認
# - モックデータから実データへの切り替わりをコンソールで確認
```

#### Vercelデプロイ戦略

```bash
# 1. プレビュー環境デプロイ（開発ブランチ）
git checkout -b feature/supabase-integration
git push origin feature/supabase-integration
# → 自動的にプレビューURLが生成される

# 2. 環境変数設定（Vercel Dashboard）
# プロジェクト設定 > Environment Variables で設定
# - NEXT_PUBLIC_SUPABASE_URL
# - NEXT_PUBLIC_SUPABASE_ANON_KEY

# 3. 本番デプロイ（mainブランチマージ後）
git checkout main
git merge feature/supabase-integration
git push origin main
# → 本番環境に自動デプロイ
```

### 開発段階別ワークフロー

#### 1. 設計・調査段階

```bash
# ワイヤーフレームの確認
# wireframe/フォルダのHTMLファイルを参照

# 技術調査とトレンド確認
gemini -p "[技術名] について2025年の最新トレンドと、個人開発で使いやすいライブラリを調べて"

# 競合サイトの分析
gemini -p "Web小説閲覧サイトの既存サービスを調べて、差別化ポイントを提案して"
```

#### 2. 実装段階

```bash
# Next.jsプロジェクト作成
npx create-next-app@latest frontend --typescript --tailwind --app

# shadcn/ui初期化
cd frontend && npx shadcn-ui@latest init

# Supabase型生成
supabase gen types typescript --project-id YOUR_PROJECT_ID > lib/database.types.ts

# TDDサイクルに従った段階的な開発
# 1. コンポーネントテスト作成
# 2. shadcn/uiコンポーネント選定・カスタマイズ
# 3. Atomic Design原則に従ったコンポーネント構築
# 4. TypeScript型定義とSupabase連携
# 5. レスポンシブ対応（Tailwind CSS v4）
```

#### 3. 検証・改善段階

```bash
# 技術的検証
gemini -p "このコードの技術的な内容に間違いがないか確認して"

# ユーザビリティチェック
gemini -p "このUIをより使いやすくするための改善点を教えて"

# パフォーマンス確認
gemini -p "このコードのパフォーマンスを改善する方法を提案して"

# 各ブラウザでの動作確認
# スマホ表示の確認
# 機能の動作テスト
# TDDテストの実行確認
```

## 品質管理

### 開発前チェックリスト

- [ ] 作業計画をユーザーに報告したか？
- [ ] 変更範囲を最小限に限定したか？
- [ ] 既存のワイヤーフレームに準拠しているか？
- [ ] スマホファーストで設計されているか？
- [ ] TDDアプローチでテストを先行作成したか？

### 実装完了前チェックリスト

- [ ] 技術的内容の正確性確認（Gemini）
- [ ] ユーザビリティとアクセシビリティの確認（Claude）
- [ ] 全ブラウザでの動作確認（実際に検証）
- [ ] レスポンシブデザインの確認
- [ ] パフォーマンス観点での最適化確認（Gemini）
- [ ] 要件仕様に適した実装レベルかの確認
- [ ] HTML構造が適切か？
- [ ] CSS命名規則に従っているか？
- [ ] JavaScript動作確認済みか？
- [ ] TDDテストが全て通るか？

### 実践チェックリスト（作業前の確認事項）

- [ ] 作業計画をユーザーに報告したか？
- [ ] 変更範囲を最小限に限定したか？
- [ ] 指示外の変更を避けたか？
- [ ] 最適化案は事前承認を得たか？
- [ ] 全ての原則を順守したか？

### 継続的改善

- 実装後のユーザーフィードバックを次回開発に反映
- 各AIツールの得意分野を活かした役割分担の最適化
- 開発効率と品質向上のためのワークフロー改善

## 技術的ガイドライン

### HTMLコーディング

- セマンティックHTMLの使用
- アクセシビリティ配慮
- SEO基本対応

### CSSコーディング

- モバイルファーストアプローチ
- Flexbox/Grid活用
- 命名規則の統一

### JavaScriptコーディング

- TDD原則に従った開発
- バニラJS優先
- モジュール化の推進

## 開発フェーズ

### フェーズ1: Next.js基本構造 ✅ **完了**

- [x] Next.js 15プロジェクト作成（App Router + TypeScript）
- [x] shadcn/ui初期化とTailwind CSS v4設定
- [x] 基本レイアウトコンポーネント実装

### フェーズ2: コンポーネント実装 ✅ **完了**

- [x] Atomic Designに基づくコンポーネント設計
- [x] shadcn/uiベースのカスタムコンポーネント実装
- [x] TypeScript型定義とSupabase連携準備
- [x] TDDによるコンポーネントテスト（全59テスト通過）

### フェーズ3: 本番環境準備・デプロイ 🚀 **進行中**

- [ ] Supabase本番API連携とデータベース設定
- [ ] Vercel環境変数設定とデプロイメント
- [ ] 本番環境でのパフォーマンス最適化
- [ ] SEO対応とアクセシビリティ確認

## 参考資料

### ワイヤーフレーム

- `../wireframe/01_top_page.html` - トップページ/小説一覧
- `../wireframe/02_novel_detail.html` - 小説詳細ページ
- `../wireframe/03_chapter_reading.html` - 章閲覧ページ

---

**最終更新**: 2025-07-14  
**現在のステータス**: フェーズ3（本番環境準備）進行中  
